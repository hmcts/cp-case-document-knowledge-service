spring:
  application:
    name: cp-case-document-knowledge-service
  jpa:
    open-in-view: false
  datasource:
      url: ${CP_CDK_DATASOURCE_URL:jdbc:postgresql://localhost:5432/cdk}
      username: ${CP_CDK_DATASOURCE_USERNAME:postgres}
      password: ${CP_CDK_DATASOURCE_PASSWORD:postgres}
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

server:
  port: ${SERVER_PORT:8082}
  shutdown: graceful
  http2:
    enabled: true
  forward-headers-strategy: framework   # honor X-Forwarded-* behind proxies
  compression:
    enabled: true
    min-response-size: 2KB
    mime-types: "application/json,application/xml,text/html,text/plain,text/xml,text/css,application/javascript"

management:
  server:
    # Keep actuator on same port by default; override if you want a separate port
    port: ${MANAGEMENT_SERVER_PORT:${SERVER_PORT:8082}}
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: "health,info,metrics,prometheus,env,loggers,threaddump"
  endpoint:
    health:
      probes:
        enabled: false                  # liveness/readiness groups
  metrics:
    tags:
      service: cp-case-document-knowledge-service
      cluster: ${CLUSTER_NAME:local}
      region: ${REGION:local}
  tracing:
    tracing:
      enabled: false
    sampling:
      probability: ${TRACING_SAMPLER_PROBABILITY:1.0}
  otlp:
    tracing:
      enabled: ${OTEL_METRICS_ENABLED:false}
      endpoint: ${OTEL_TRACES_URL:http://localhost:4318/traces}
    metrics:
      export:
        enabled: ${OTEL_METRICS_ENABLED:false}
        url: ${OTEL_METRICS_URL:http://localhost:4318/metrics}

logging:
  level:
    root: INFO
    org:
        flywaydb: DEBUG
  config: classpath:logback.xml

# Optional: Java 21 virtual threads (Boot 3.2+ / 4.x)
spring.threads.virtual.enabled: ${VIRTUAL_THREADS:false}

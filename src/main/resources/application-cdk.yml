# Storage configuration (Azure blob)
cdk:
  storage:
    azure:
      # Pick one: connection-string | managed-identity | azurite
      mode: ${CP_CDK_STORAGE_MODE:connection-string}

      # Common
      container: ${CP_CDK_AZURE_STORAGE_CONTAINER:cdk}

      # Connection string mode
      connection-string: ${CP_CDK_AZURE_STORAGE_CONNECTION_STRING:}

      # Managed Identity mode
      account-name: ${CP_CDK_STORAGE_ACCOUNT_NAME:}
      blob-endpoint: ${CP_CDK_STORAGE_BLOB_ENDPOINT:}
      managed-identity-client-id: ${AZURE_CLIENT_ID:}

      # Copy ops
      copy-poll-interval-ms: ${CP_CDK_AZURE_POLL_INTERVAL_MS:1000}
      copy-timeout-seconds: ${CP_CDK_AZURE_TIMEOUT_SECONDS:120}

      # Azurite (local) â€“ only used when mode=azurite
      azurite:
        image: ${CP_CDK_AZURITE_IMAGE:mcr.microsoft.com/azure-storage/azurite:3.33.0}


  ingestion:
    core-pool-size: ${CP_CDK_INGESTION_CORE_POOL_SIZE:8}
    max-pool-size: ${CP_CDK_INGESTION_MAX_POOL_SIZE:16}
    queue-capacity: ${CP_CDK_INGESTION_QUEUE_CAPACITY:64}
    batch:
      partition:
        case-grid-size: ${CDK_INGESTION_BATCH_PARTITION_CASE_GRID_SIZE:8}
        query-grid-size: ${CDK_INGESTION_BATCH_PARTITION_QUERY_GRID_SIZE:4}
        filter-grid-size: ${CDK_INGESTION_BATCH_PARTITION_FILTER_GRID_SIZE:4}
    verify:
      max-wait-ms: ${CDK_INGEST_VERIFY_MAX_WAIT_MS:3600000}
      poll-interval-ms: ${CDK_INGESTION_VERIFY_POLL_INTERVAL_MS:30000}
    retry:
      max-attempts: ${CDK_RETRY_MAX_WAIT_MS:10}
      backoff:
        initial-ms: ${CDK_RETRY_BACKOFF_INITIAL_MS:1000}
        max-ms: ${CDK_RETRY_BACKOFF_MAX_MS:15000}
    upload:
      blob-prefix: ${CDK_UPLOAD_BLOB_PREFIX:cases}
      date-pattern: ${CDK_UPLOAD_DATE_PATTERN:yyyyMMdd}
      file-extension: ${CDK_UPLOAD_FILE_EXTENSION:.pdf}
      content-type: ${CDK_UPLOAD_CONTENT_TYPE:application/pdf}
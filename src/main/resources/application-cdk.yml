# Storage configuration (Azure blob)
cdk:
  storage:
    azure:
      # Pick one: connection-string | managed-identity | azurite
      mode: ${CP_CDK_STORAGE_MODE:connection-string}

      # Common
      container: ${CP_CDK_AZURE_STORAGE_CONTAINER:cdk}

      # Connection string mode
      connection-string: ${CP_CDK_AZURE_STORAGE_CONNECTION_STRING:}

      # Managed Identity mode
      account-name: ${CP_CDK_STORAGE_ACCOUNT_NAME:}
      blob-endpoint: ${CP_CDK_STORAGE_BLOB_ENDPOINT:}
      managed-identity-client-id: ${AZURE_CLIENT_ID:}

      # Copy ops
      copy-poll-interval-ms: ${CP_CDK_AZURE_POLL_INTERVAL_MS:1000}
      copy-timeout-seconds: ${CP_CDK_AZURE_TIMEOUT_SECONDS:120}

  ingestion:
    core-pool-size: ${CP_CDK_INGESTION_CORE_POOL_SIZE:10}
    max-pool-size: ${CP_CDK_INGESTION_MAX_POOL_SIZE:20}
    queue-capacity: ${CP_CDK_INGESTION_QUEUE_CAPACITY:200}

    feature:
      use-job-manager: ${CP_CDK_FEATURE_USE_JOB_MANAGER:true}

    batch:
      partition:
        case-grid-size: ${CDK_INGESTION_BATCH_PARTITION_CASE_GRID_SIZE:8}
        query-grid-size: ${CDK_INGESTION_BATCH_PARTITION_QUERY_GRID_SIZE:4}
        filter-grid-size: ${CDK_INGESTION_BATCH_PARTITION_FILTER_GRID_SIZE:4}

    verify:
      scheduler:
        enabled: ${CP_CDK_VERIFY_SCHEDULER_ENABLED:true}
        delay-ms: ${CP_CDK_VERIFY_SCHEDULER_DELAY_MS:5000}
        batch-size: ${CP_CDK_VERIFY_SCHEDULER_BATCH_SIZE:1}
        max-attempts: ${CP_CDK_VERIFY_SCHEDULER_MAX_ATTEMPTS:3000}
        lock-ttl-ms: ${CP_CDK_VERIFY_SCHEDULER_LOCK_TTL_MS:10000}

    retry:
      # fixed name so it’s actually “max attempts”, not “max wait”
      max-attempts: ${CDK_RETRY_MAX_ATTEMPTS:10}
      backoff:
        initial-ms: ${CDK_RETRY_BACKOFF_INITIAL_MS:1000}
        max-ms: ${CDK_RETRY_BACKOFF_MAX_MS:15000}

    upload:
      blob-prefix: ${CDK_UPLOAD_BLOB_PREFIX:cases}
      date-pattern: ${CDK_UPLOAD_DATE_PATTERN:yyyyMMdd}
      file-extension: ${CDK_UPLOAD_FILE_EXTENSION:.pdf}
      content-type: ${CDK_UPLOAD_CONTENT_TYPE:application/pdf}

  jobmanager:
    retry:
      default:
        max-attempts: ${CDK_JOBMANAGER_RETRY_DEFAULT_MAX_ATTEMPTS:3}
        delay-seconds: ${CDK_JOBMANAGER_RETRY_DEFAULT_DELAY_SECONDS:20}
      verify-document-status:
        max-attempts: ${CDK_JOBMANAGER_RETRY_VERIFY_DOC_MAX_ATTEMPTS:50}
        delay-seconds: ${CDK_JOBMANAGER_RETRY_VERIFY_DOC_DELAY_SECONDS:5}
      questions-retry:
        max-attempts: ${CDK_JOBMANAGER_RETRY_QUESTIONS_MAX_ATTEMPTS:100}
        delay-seconds: ${CDK_JOBMANAGER_RETRY_QUESTIONS_DELAY_SECONDS:10}

taskmanager:
  schema:
    enabled=true: